<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>トップ画面</title>
  <style>
    /* 右上に検索フォームを配置 */
    .search-form {
      float: right;
      margin-bottom: 10px;
    }
    /* ボタン横並びを整える */
    .header-buttons {
      margin-bottom: 10px;
    }
    .header-buttons button {
      margin-right: 5px;
    }
    /* 月切替リンクと年月表示の間隔調整 */
    .month-navigation {
      margin-bottom: 15px;
    }
    .month-navigation a {
      margin: 0 10px;
      text-decoration: none;
      font-weight: bold;
    }

    /* 祝日・会社休日用のスタイル */
    .holiday-cell {
      background-color: rgba(255, 105, 180, 0.5); /* ホットピンク、透明度50% */
      position: relative;
    }
    /* input日付ボックスのスタイル */
    .performance-date-input {
      width: 100%;
      padding-right: 60px; /* ラベル分のスペースを右に確保 */
      box-sizing: border-box;
      position: relative;
      z-index: 1;
    }
    /* 「[会社休日]」ラベルのスタイル */
    .holiday-label {
      position: absolute;
      top: 50%;
      right: 10px; /* inputの右内側に配置 */
      transform: translateY(-50%);
      background-color: rgba(255, 105, 180, 0.5); /* 透明度50%のホットピンク */
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: bold;
      color: #800000;
      pointer-events: none;
      user-select: none;
      z-index: 2;
      font-size: 0.8em;
    }
    /* 集計表のスタイル */
    .summary-table {
      margin-top: 20px;
      border-collapse: collapse;
      width: 100%;
      max-width: 800px;
    }
    .summary-table th, .summary-table td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: center;
    }
    .summary-table thead th {
      background-color: #c8dafc;
      font-weight: bold;
    }
  </style>
</head>
<body class="task-body">
  <div class="header-buttons">
    <button onclick="location.href='/logout'">ログアウト</button>
    <button onclick="history.back()">戻る</button>
  </div>

  <!-- 検索フォーム -->
  <form class="search-form" th:action="@{/{employeeId}/top/jisseki_user(employeeId=${userId})}" method="get">
    <label for="year-select">年:</label>
    <select id="year-select" name="year" required>
      <option th:each="y : ${#numbers.sequence(2020, 2030)}" th:value="${y}" th:text="${y}" th:selected="${y == year}"></option>
    </select>
    <label for="month-select">月:</label>
    <select id="month-select" name="month" required>
      <option th:each="m : ${#numbers.sequence(1, 12)}" th:value="${m}" th:text="${m}" th:selected="${m == month}"></option>
    </select>
    <button type="submit">検索</button>
  </form>

  <!-- 月切替ナビゲーション -->
  <div class="month-navigation">
    <a th:href="@{/{employeeId}/top/jisseki_user(employeeId=${userId}, year=${prevYear}, month=${prevMonth})}">&lt;&lt;</a>
    <span th:text="${year} + '/' + ${month}">年月</span>
    <a th:href="@{/{employeeId}/top/jisseki_user(employeeId=${userId}, year=${nextYear}, month=${nextMonth})}">&gt;&gt;</a>
  </div>

  <div class="database-container">
    <table class="performance-database">
      <thead>
        <tr>
          <th>日付</th>
          <th>曜日</th>
          <th>出勤時間</th>
          <th>退勤時間</th>
          <th>休憩時間(h)</th>
          <th>申請</th>
          <th>状況</th>
          <th>事由</th>
          <th>再申請</th>
          <th>取消</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="performance : ${performances}" class="performance-row" th:data-id="${performance.id}">
          <td th:classappend="${holidays.contains(performance.date)} ? 'holiday-cell' : ''" style="position: relative;">
            <input type="date" th:value="${performance.date}" class="performance-date-input" disabled />
            <span th:if="${holidays.contains(performance.date)}" class="holiday-label">[会社休日]</span>
            <input type="hidden" th:name="date" th:value="${performance.date}" />
          </td>
          <td th:classappend="${holidays.contains(performance.date)} ? 'holiday-cell' : ''">
            <input type="text" th:value="${performance.dayOfWeek}" class="performance-dayofweek-input" readonly />
          </td>
          <td><input type="time" th:value="${performance.startTime}" class="performance-start-input" /></td>
          <td><input type="time" th:value="${performance.endTime}" class="performance-end-input" /></td>
          <td><input type="text" th:value="${performance.breakTime}" class="performance-break-input" readonly /></td>
          <!-- disabledを外してボタン有効化 -->
          <td><input type="button" value="申請" class="submit-button" /></td>
          <td>
            <select class="status-select">
              <option value="未申請" th:selected="${performance.status == '未申請'}">未申請</option>
              <option value="申請済み" th:selected="${performance.status == '申請済み'}">申請済み</option>
              <option value="確定済み" th:selected="${performance.status == '確定済み'}">確定済み</option>
              <option value="差し戻し" th:selected="${performance.status == '差し戻し'}">差し戻し</option>
            </select>
            <input type="hidden" th:name="status" th:value="${performance.status}" />
          </td>
          <td><input type="text" th:value="${performance.reason}" class="performance-reason-input" readonly /></td>
          <!-- disabledを外してボタン有効化 -->
          <td><input type="button" value="再申請" class="resubmit-button" /></td>
          <td><input type="button" value="取消" class="remove-button" /></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- 集計表 -->
  <div class="summary-container">
    <table class="summary-table">
      <thead>
        <tr>
          <th>月</th>
          <th>月間所定労働時間(h)</th>
          <th>実労働時間(h)</th>
          <th>残業時間(h)</th>
          <th>残年休日数</th>
          <th>残振休日数</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td th:text="${month}">7</td>
          <td th:text="${scheduledHours}">140</td>
          <td th:text="${actualHours}">160</td>
          <td th:text="${overtimeHours}">20</td>
          <td th:text="${paidHoliday}">5</td>
          <td th:text="${compDay}">5</td>
        </tr>
      </tbody>
    </table>
  </div>

</body>
</html>
